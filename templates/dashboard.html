{% extends "base.html" %}
{% block title %}Dashboard - DLP Security{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <h1 class="mb-4"><i class="bi bi-speedometer2"></i> Dashboard</h1>
    
    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <i class="bi bi-search stat-icon"></i>
                <h2 class="stat-number">{{ total_scans or 0 }}</h2>
                <p class="stat-label">Total Scans</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <i class="bi bi-shield-exclamation stat-icon"></i>
                <h2 class="stat-number">{{ total_threats or 0 }}</h2>
                <p class="stat-label">Threats Found</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <i class="bi bi-bell stat-icon"></i>
                <h2 class="stat-number">{{ pending_alerts or 0 }}</h2>
                <p class="stat-label">Pending Alerts</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <i class="bi bi-cpu stat-icon"></i>
                <h2 class="stat-number">{{ system_info.cpu_percent|round(1) if system_info else 0 }}%</h2>
                <p class="stat-label">CPU Usage</p>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-lightning-fill"></i> Quick Actions
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6">
                            <a href="{{ url_for('scan_page') }}" class="btn btn-primary w-100 py-3">
                                <i class="bi bi-search"></i><br>Start Scan
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('encrypt_page') }}" class="btn btn-success w-100 py-3">
                                <i class="bi bi-lock"></i><br>Encrypt File
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('threats_page') }}" class="btn btn-warning w-100 py-3">
                                <i class="bi bi-exclamation-triangle"></i><br>View Threats
                            </a>
                        </div>
                        <div class="col-6">
                            <a href="{{ url_for('scan_results') }}" class="btn btn-info w-100 py-3">
                                <i class="bi bi-file-text"></i><br>Reports
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-activity"></i> System Status
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>CPU</span>
                            <span class="badge bg-success">{{ system_info.cpu_percent|round(1) if system_info else 0 }}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: {{ system_info.cpu_percent if system_info else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Memory</span>
                            <span class="badge bg-info">{{ system_info.memory_percent|round(1) if system_info else 0 }}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-info" style="width: {{ system_info.memory_percent if system_info else 0 }}%"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Disk</span>
                            <span class="badge bg-warning">{{ system_info.disk_percent|round(1) if system_info else 0 }}%</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-warning" style="width: {{ system_info.disk_percent if system_info else 0 }}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-clock-history"></i> Recent Scans
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Status</th>
                                    <th>Threats</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if recent_scans %}
                                    {% for scan in recent_scans[:5] %}
                                    <tr>
                                        <td>{{ scan.id[:8] }}...</td>
                                        <td><span class="badge bg-{{ 'success' if scan.status == 'completed' else 'warning' }}">{{ scan.status }}</span></td>
                                        <td><span class="badge bg-{{ 'danger' if scan.threats_found > 0 else 'success' }}">{{ scan.threats_found }}</span></td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr><td colspan="3" class="text-center">No recent scans</td></tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-exclamation-triangle"></i> Recent Threats
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Severity</th>
                                    <th>File</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if recent_threats %}
                                    {% for threat in recent_threats[:5] %}
                                    <tr>
                                        <td>{{ threat.threat_type[:15] }}</td>
                                        <td><span class="badge bg-{{ 'danger' if threat.severity == 'critical' else 'warning' if threat.severity == 'high' else 'info' }}">{{ threat.severity }}</span></td>
                                        <td>{{ threat.file_path.split('/')[-1][:20] if threat.file_path else 'N/A' }}</td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr><td colspan="3" class="text-center">No recent threats</td></tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
